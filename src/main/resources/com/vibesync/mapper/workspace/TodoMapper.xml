<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vibesync.workspace.mapper.TodoMapper">

    <!-- 사용자별 할 일 목록 조회 -->
    <select id="getTodoListByUser" parameterType="int" resultType="com.vibesync.workspace.domain.TodoVO">
        SELECT 
            todo_idx,
            text,
            todo_group,
            color,
            ac_idx,
            completed,
            created_date,
            updated_date
        FROM todo 
        WHERE ac_idx = #{acIdx}
        ORDER BY created_date DESC
    </select>

    <!-- 할 일 추가 -->
    <insert id="addTodo" parameterType="com.vibesync.workspace.domain.TodoVO">
        INSERT INTO todo (
            text, 
            todo_group, 
            color, 
            ac_idx, 
            completed, 
            created_date, 
            updated_date
        ) VALUES (
            #{text}, 
            #{todo_group}, 
            #{color}, 
            #{ac_idx}, 
            0, 
            NOW(), 
            NOW()
        )
    </insert>

    <!-- 할 일 상태 업데이트 -->
    <update id="updateTodoStatus" parameterType="map">
        UPDATE todo 
        SET completed = #{status}, 
            updated_date = NOW()
        WHERE todo_idx = #{todoIdx}
    </update>

    <!-- 할 일 삭제 -->
    <delete id="deleteTodo" parameterType="int">
        DELETE FROM todo 
        WHERE todo_idx = #{todoIdx}
    </delete>

    <!-- 할 일 수정 -->
    <update id="updateTodo" parameterType="com.vibesync.workspace.domain.TodoVO">
        UPDATE todo 
        SET text = #{text}, 
            todo_group = #{todo_group}, 
            color = #{color}, 
            updated_date = NOW()
        WHERE todo_idx = #{todo_idx}
    </update>

</mapper> 