<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vibesync.workspace.mapper.TodoMapper">

    <!-- 사용자별 할 일 목록 조회 -->
    <select id="getTodoListByUser" parameterType="int" resultType="com.vibesync.workspace.domain.TodoVO">
        SELECT 
            todo_idx as todoIdx,
            text,
            todo_group as todoGroup,
            color,
            ac_idx as acIdx,
            status,
            created_at as createdAt
        FROM todolist 
        WHERE ac_idx = #{acIdx}
        ORDER BY created_at DESC
    </select>

    <!-- 할 일 추가 -->
    <insert id="addTodo" parameterType="com.vibesync.workspace.domain.TodoVO">
    	<selectKey keyProperty="todoIdx" resultType="int" order="BEFORE">
            SELECT TODOLIST_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO todolist (
        	todo_idx,
            text, 
            todo_group, 
            color, 
            ac_idx, 
            status, 
            created_at
        ) VALUES (
        	#{todoIdx},
            #{text}, 
            #{todoGroup , jdbcType=VARCHAR}, 
            #{color}, 
            #{acIdx}, 
            #{status}, 
            SYSDATE
        )
    </insert>

    <!-- 할 일 상태 업데이트 -->
    <update id="updateTodoStatus">
        UPDATE todolist 
        SET status = #{status}
        WHERE todo_idx = #{todoIdx}
    </update>

    <!-- 할 일 삭제 -->
    <delete id="deleteTodo" parameterType="int">
        DELETE FROM todolist 
        WHERE todo_idx = #{todoIdx}
    </delete>

    <!-- 할 일 수정 -->
    <update id="updateTodo" parameterType="com.vibesync.workspace.domain.TodoVO">
        UPDATE todolist 
        SET text = #{text}, 
            todo_group = #{todoGroup , jdbcType=VARCHAR}, 
            color = #{color}
        WHERE todo_idx = #{todoIdx}
    </update>

</mapper> 